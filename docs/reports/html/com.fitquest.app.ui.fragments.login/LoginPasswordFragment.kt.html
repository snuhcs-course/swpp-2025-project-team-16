<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoginPasswordFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.fitquest.app.ui.fragments.login</a> &gt; <span class="el_source">LoginPasswordFragment.kt</span></div><h1>LoginPasswordFragment.kt</h1><pre class="source lang-java linenums">package com.fitquest.app.ui.fragments.login

import android.content.Intent
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import androidx.navigation.fragment.navArgs
import com.fitquest.app.MainActivity
import com.fitquest.app.data.remote.RetrofitClient
import com.fitquest.app.data.remote.ServiceLocator
import com.fitquest.app.data.remote.TokenManager
import com.fitquest.app.databinding.FragmentLoginPasswordBinding
import com.fitquest.app.model.NetworkResult
import com.fitquest.app.model.login.LoginRequest
import com.fitquest.app.ui.viewmodels.AuthViewModel
import com.fitquest.app.ui.viewmodels.AuthViewModelFactory

<span class="fc" id="L23">class LoginPasswordFragment : Fragment() {</span>

    private var _binding: FragmentLoginPasswordBinding? = null
<span class="fc" id="L26">    private val binding get() = _binding!!</span>

<span class="fc" id="L28">    private val authViewModel: AuthViewModel by viewModels {</span>
<span class="fc" id="L29">        AuthViewModelFactory(ServiceLocator.authApiService, requireContext())</span>
    }

<span class="fc" id="L32">    private val args: LoginPasswordFragmentArgs by navArgs()</span>
<span class="fc" id="L33">    private var email: String = &quot;&quot;</span>


    override fun onCreate(savedInstanceState: Bundle?) {
<span class="fc" id="L37">        super.onCreate(savedInstanceState)</span>
<span class="fc" id="L38">        email = args.email</span>
<span class="fc" id="L39">    }</span>

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
<span class="fc" id="L46">        _binding = FragmentLoginPasswordBinding.inflate(inflater, container, false)</span>
<span class="fc" id="L47">        return binding.root</span>
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="fc" id="L51">        super.onViewCreated(view, savedInstanceState)</span>
<span class="fc" id="L52">        binding.tvEmail.text = email</span>

<span class="fc" id="L54">        binding.btnPasswordLogin.setOnClickListener {</span>
<span class="fc" id="L55">            val password = binding.etPassword.text.toString().trim()</span>

<span class="fc" id="L57">            when {</span>
<span class="fc bfc" id="L58" title="All 4 branches covered.">                password.isEmpty() -&gt; {</span>
<span class="fc" id="L59">                    Toast.makeText(requireContext(),</span>
<span class="fc" id="L60">                        &quot;Please enter your password!&quot;,</span>
<span class="fc" id="L61">                        Toast.LENGTH_SHORT</span>
<span class="fc" id="L62">                    ).show()</span>
                }
<span class="fc bfc" id="L64" title="All 2 branches covered.">                password.length &lt; 6 -&gt; {</span>
<span class="fc" id="L65">                    Toast.makeText(requireContext(),</span>
<span class="fc" id="L66">                        &quot;Password must be at least 6 characters&quot;,</span>
<span class="fc" id="L67">                        Toast.LENGTH_SHORT</span>
<span class="fc" id="L68">                    ).show()</span>
                }
                else -&gt; {
<span class="fc" id="L71">                    verifyPassword(email, password)</span>
                }
            }
<span class="fc" id="L74">        }</span>

<span class="fc" id="L76">        binding.btnBack.setOnClickListener {</span>
<span class="fc" id="L77">            findNavController().navigateUp()</span>
<span class="fc" id="L78">        }</span>

<span class="fc" id="L80">        observeLoginResult()</span>
<span class="fc" id="L81">    }</span>


    private fun verifyPassword(email: String, password: String) {
<span class="pc bpc" id="L85" title="1 of 4 branches missed.">        if (email == &quot;test@test.com&quot; &amp;&amp; password == &quot;0000&quot;) {</span>
<span class="nc" id="L86">            val fakeToken = &quot;TEST_TOKEN&quot;</span>
<span class="nc" id="L87">            val fakeName = &quot;Test User&quot;</span>
<span class="nc" id="L88">            TokenManager.saveToken(requireContext(), fakeToken, email, fakeName)</span>
<span class="nc" id="L89">            Toast.makeText(requireContext(), &quot;Welcome back, $fakeName&quot;, Toast.LENGTH_SHORT).show()</span>
<span class="nc" id="L90">            return</span>
        }

<span class="fc" id="L93">        authViewModel.login(LoginRequest(email, password))</span>
<span class="fc" id="L94">    }</span>

    private fun observeLoginResult() {
<span class="fc" id="L97">        authViewModel.loginResult.observe(viewLifecycleOwner) { result -&gt;</span>
<span class="fc" id="L98">            when (result) {</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">                is NetworkResult.Idle -&gt; {}</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">                is NetworkResult.Success -&gt; {</span>
<span class="fc" id="L101">                    val body = result.data</span>
<span class="pc bpc" id="L102" title="2 of 4 branches missed.">                    TokenManager.saveToken(requireContext(), body.token ?: &quot;&quot;, email, body.name ?: &quot;&quot;)</span>
<span class="fc" id="L103">                    Toast.makeText(requireContext(), &quot;Welcome back, ${body.name}&quot;, Toast.LENGTH_SHORT).show()</span>
<span class="fc" id="L104">                    navigateToMainActivity()</span>
                }
<span class="nc bnc" id="L106" title="All 2 branches missed.">                is NetworkResult.ServerError -&gt; {</span>
<span class="nc" id="L107">                    Toast.makeText(requireContext(),</span>
<span class="nc" id="L108">                        &quot;Invalid email or password&quot;,</span>
<span class="nc" id="L109">                        Toast.LENGTH_SHORT</span>
<span class="nc" id="L110">                    ).show()</span>
                }
<span class="nc" id="L112">                is NetworkResult.NetworkError -&gt; {</span>
<span class="nc" id="L113">                    Toast.makeText(</span>
<span class="nc" id="L114">                        requireContext(),</span>
<span class="nc" id="L115">                        &quot;Network error: ${result.exception.localizedMessage}&quot;,</span>
<span class="nc" id="L116">                        Toast.LENGTH_SHORT</span>
<span class="nc" id="L117">                    ).show()</span>
                }
            }
<span class="fc" id="L120">        }</span>
<span class="fc" id="L121">    }</span>

    private fun navigateToMainActivity() {
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">        activity?.let {</span>
<span class="fc" id="L125">            it.startActivity(Intent(it, MainActivity::class.java))</span>
<span class="fc" id="L126">            it.finish()</span>
<span class="fc" id="L127">        }</span>
<span class="fc" id="L128">    }</span>

    override fun onDestroyView() {
<span class="fc" id="L131">        super.onDestroyView()</span>
<span class="fc" id="L132">        _binding = null</span>
<span class="fc" id="L133">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>