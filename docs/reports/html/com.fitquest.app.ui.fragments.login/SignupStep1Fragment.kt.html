<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SignupStep1Fragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.fitquest.app.ui.fragments.login</a> &gt; <span class="el_source">SignupStep1Fragment.kt</span></div><h1>SignupStep1Fragment.kt</h1><pre class="source lang-java linenums">package com.fitquest.app.ui.fragments.login

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.fragment.app.viewModels
import com.fitquest.app.data.remote.RetrofitClient
import com.fitquest.app.data.remote.TokenManager
import com.fitquest.app.databinding.FragmentSignupStep1Binding
import com.fitquest.app.model.NetworkResult
import com.fitquest.app.model.login.SignupRequest
import com.fitquest.app.ui.viewmodels.AuthViewModel
import com.fitquest.app.ui.viewmodels.AuthViewModelFactory
import kotlin.getValue
import androidx.navigation.fragment.findNavController
import androidx.navigation.fragment.navArgs
import com.fitquest.app.data.remote.ServiceLocator
import com.fitquest.app.util.animateLogo

<span class="fc" id="L23">class SignupStep1Fragment : Fragment() {</span>

    private var _binding: FragmentSignupStep1Binding? = null
<span class="fc" id="L26">    private val binding get() = _binding!!</span>

<span class="fc" id="L28">    private val authViewModel: AuthViewModel by viewModels {</span>
<span class="fc" id="L29">        AuthViewModelFactory(ServiceLocator.authApiService, requireContext())</span>
    }

<span class="fc" id="L32">    private val args: SignupStep1FragmentArgs by navArgs()</span>
<span class="fc" id="L33">    private var email: String = &quot;&quot;</span>
<span class="fc" id="L34">    private var inputEmail: String = &quot;&quot;</span>
<span class="fc" id="L35">    private var inputName: String = &quot;&quot;</span>
<span class="fc" id="L36">    private var inputPassword: String = &quot;&quot;</span>

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="fc" id="L39">        super.onCreate(savedInstanceState)</span>
<span class="fc" id="L40">        email = args.email</span>
<span class="fc" id="L41">    }</span>

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
<span class="fc" id="L48">        _binding = FragmentSignupStep1Binding.inflate(inflater, container, false)</span>
<span class="fc" id="L49">        return binding.root</span>
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="fc" id="L53">        super.onViewCreated(view, savedInstanceState)</span>

<span class="fc" id="L55">        binding.etEmail.setText(email)</span>

<span class="fc" id="L57">        binding.btnContinue.setOnClickListener {</span>
<span class="fc bfc" id="L58" title="All 2 branches covered.">            if (validateInputs()) signupUser()</span>
<span class="fc" id="L59">        }</span>

<span class="fc" id="L61">        binding.btnBack.setOnClickListener {</span>
<span class="fc" id="L62">            findNavController().navigateUp()</span>
<span class="fc" id="L63">        }</span>

<span class="fc" id="L65">        observeSignupResult()</span>

<span class="fc" id="L67">        animateLogo(binding.ivLogo)</span>
<span class="fc" id="L68">    }</span>

    private fun validateInputs(): Boolean {
<span class="fc" id="L71">        val email = binding.etEmail.text.toString()</span>
<span class="fc" id="L72">        val username = binding.etHeroName.text.toString()</span>
<span class="fc" id="L73">        val password = binding.etPassword.text.toString()</span>
<span class="fc" id="L74">        val confirmPassword = binding.etConfirmPassword.text.toString()</span>

<span class="fc" id="L76">        return when {</span>
<span class="pc bpc" id="L77" title="2 of 4 branches missed.">            email.isEmpty() -&gt; {</span>
<span class="nc" id="L78">                Toast.makeText(requireContext(),</span>
<span class="nc" id="L79">                &quot;Email is required&quot;,</span>
<span class="nc" id="L80">                Toast.LENGTH_SHORT</span>
<span class="nc" id="L81">            ).show(); false }</span>
<span class="fc bfc" id="L82" title="All 4 branches covered.">            username.isEmpty() -&gt; {</span>
<span class="fc" id="L83">                Toast.makeText(requireContext(),</span>
<span class="fc" id="L84">                &quot;Username is required&quot;,</span>
<span class="fc" id="L85">                Toast.LENGTH_SHORT</span>
<span class="fc" id="L86">            ).show(); false }</span>
<span class="fc bfc" id="L87" title="All 4 branches covered.">            password.isEmpty() -&gt; {</span>
<span class="fc" id="L88">                Toast.makeText(requireContext(),</span>
<span class="fc" id="L89">                    &quot;Password is required&quot;,</span>
<span class="fc" id="L90">                    Toast.LENGTH_SHORT</span>
<span class="fc" id="L91">            ).show(); false }</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">            password.length &lt; 6 -&gt; {</span>
<span class="fc" id="L93">                Toast.makeText(requireContext(),</span>
<span class="fc" id="L94">                    &quot;Password must be at least 6 characters&quot;,</span>
<span class="fc" id="L95">                    Toast.LENGTH_SHORT</span>
<span class="fc" id="L96">                ).show(); false }</span>
<span class="pc bpc" id="L97" title="2 of 4 branches missed.">            confirmPassword.isEmpty() -&gt; {</span>
<span class="nc" id="L98">                Toast.makeText(requireContext(),</span>
<span class="nc" id="L99">                    &quot;Confirm Password is required&quot;,</span>
<span class="nc" id="L100">                    Toast.LENGTH_SHORT</span>
<span class="nc" id="L101">                ).show(); false }</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">            password != confirmPassword -&gt; {</span>
<span class="fc" id="L103">                Toast.makeText(requireContext(),</span>
<span class="fc" id="L104">                    &quot;Passwords do not match&quot;,</span>
<span class="fc" id="L105">                    Toast.LENGTH_SHORT</span>
<span class="fc" id="L106">                ).show(); false }</span>
<span class="fc" id="L107">            else -&gt; true</span>
        }
    }

    private fun signupUser() {
<span class="fc" id="L112">        inputEmail = binding.etEmail.text.toString().trim()</span>
<span class="fc" id="L113">        inputName = binding.etHeroName.text.toString().trim()</span>
<span class="fc" id="L114">        inputPassword = binding.etPassword.text.toString().trim()</span>

<span class="fc" id="L116">        authViewModel.signup(SignupRequest(name = inputName, email = inputEmail, password = inputPassword))</span>
<span class="fc" id="L117">    }</span>

    private fun observeSignupResult() {
<span class="fc" id="L120">        authViewModel.signupResult.observe(viewLifecycleOwner) { result -&gt;</span>
<span class="fc" id="L121">            when (result) {</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">                is NetworkResult.Idle -&gt; {}</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">                is NetworkResult.Success -&gt; {</span>
<span class="fc" id="L124">                    authViewModel.resetSignupResult()</span>
<span class="fc" id="L125">                    val body = result.data</span>
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">                    TokenManager.saveToken(requireContext(), body.token ?: &quot;&quot;, inputEmail, inputName)</span>
<span class="fc" id="L127">                    Toast.makeText(requireContext(), body.message, Toast.LENGTH_SHORT).show()</span>
<span class="fc" id="L128">                    val action = SignupStep1FragmentDirections</span>
<span class="fc" id="L129">                        .actionSignupStep1FragmentToSignupStep2Fragment(</span>
<span class="fc" id="L130">                            email = inputEmail,</span>
<span class="fc" id="L131">                            password = inputPassword,</span>
<span class="fc" id="L132">                            username = inputName</span>
                        )
<span class="fc" id="L134">                    findNavController().navigate(action)</span>
                }
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">                is NetworkResult.ServerError -&gt; {</span>
<span class="fc" id="L137">                    authViewModel.resetSignupResult()</span>
<span class="fc" id="L138">                    Toast.makeText(requireContext(), &quot;Invalid email or password&quot;, Toast.LENGTH_SHORT).show()</span>
                }
<span class="nc" id="L140">                is NetworkResult.NetworkError -&gt; {</span>
<span class="nc" id="L141">                    authViewModel.resetSignupResult()</span>
<span class="nc" id="L142">                    Toast.makeText(requireContext(), &quot;Network error: ${result.exception.localizedMessage}&quot;, Toast.LENGTH_SHORT).show()</span>
                }
            }
<span class="fc" id="L145">        }</span>
<span class="fc" id="L146">    }</span>

    override fun onDestroyView() {
<span class="fc" id="L149">        super.onDestroyView()</span>
<span class="fc" id="L150">        _binding = null</span>
<span class="fc" id="L151">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>